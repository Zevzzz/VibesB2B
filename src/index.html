<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vibesB2B</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800&display=swap" rel="stylesheet">
    <link href="./output.css" rel="stylesheet">
</head>
<body class="min-h-screen bg-white text-gray-900 font-sans">
    <!-- Custom Title Bar -->
    <div class="fixed top-0 left-0 right-0 h-8 bg-white border-b border-gray-200 flex items-center justify-start px-4 z-50" style="-webkit-app-region: drag;">
        <div class="flex items-center space-x-1" style="-webkit-app-region: no-drag;">
            <button onclick="closeWindow()" class="w-3 h-3 rounded-full bg-red-400 hover:bg-red-500 transition-colors"></button>
            <button onclick="minimizeWindow()" class="w-3 h-3 rounded-full bg-yellow-400 hover:bg-yellow-500 transition-colors"></button>
            <button onclick="maximizeWindow()" class="w-3 h-3 rounded-full bg-green-400 hover:bg-green-500 transition-colors"></button>
        </div>
    </div>

    <div class="pt-10">
    <!-- Setup Page -->
    <div id="setup-page" class="container mx-auto max-w-lg">
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-6">
                <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-light text-gray-900 mb-3">Welcome to VibeB2B</h1>
            <p class="text-gray-600">Configure your API keys to get started</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8">
            <div class="mb-6">
                <h2 class="text-xl font-light text-gray-900 mb-2">API Configuration</h2>
                <p class="text-sm text-gray-600">Please enter your API credentials below</p>
            </div>
                <form id="api-keys-form" class="space-y-6">
                    <!-- Attio API Token -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Attio API Token</label>
                        <input
                            type="password"
                            id="attio-token"
                            placeholder="Enter your Attio API token"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200 bg-white text-gray-900 placeholder:text-gray-400"
                            required
                        />
                    </div>

                    <!-- Slack Bot Token -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Slack Bot Token</label>
                        <input
                            type="password"
                            id="slack-bot-token"
                            placeholder="xoxb-your-bot-token-here"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200 bg-white text-gray-900 placeholder:text-gray-400"
                            required
                        />
                    </div>

                    <!-- Slack Channel ID -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Slack Channel ID</label>
                        <input
                            type="text"
                            id="slack-channel-id"
                            placeholder="C1234567890"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200 bg-white text-gray-900 placeholder:text-gray-400"
                            required
                        />
                    </div>

                    <!-- Slack Signing Secret -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Slack Signing Secret</label>
                        <input
                            type="password"
                            id="slack-signing-secret"
                            placeholder="Enter your Slack signing secret"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200 bg-white text-gray-900 placeholder:text-gray-400"
                            required
                        />
                    </div>

                    <!-- Gemini API Key -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Gemini API Key</label>
                        <input
                            type="password"
                            id="gemini-api-key"
                            placeholder="Enter your Google AI API key"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200 bg-white text-gray-900 placeholder:text-gray-400"
                            required
                        />
                    </div>

                    <div class="pt-4">
                        <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 shadow-sm hover:shadow-md">
                            Get Started
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Interface (hidden initially) -->
    <div id="main-interface" class="container mx-auto pt-20 max-w-6xl" style="display: none;">
        <div class="text-center mb-8 my-auto">
            <div class="flex items-center justify-center mb-3">
                <img src="../Beach_Ball_PNG_Clip_Art_Image-2055932628.png" alt="Beach Ball" class="w-8 h-8 object-contain mr-2">
                <h1 class="text-3xl font-light text-gray-900">vibesB2B</h1>
            </div>
            <p class="text-gray-600">Server for the AI Powered Business Assistant</p>
        </div>


        <!-- Activity Log -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6" id="log-area">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-light text-gray-900">Activity Log</h3>
                <div class="flex items-center text-sm text-gray-500">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Live Updates
                </div>
            </div>
            <div class="max-h-80 overflow-y-auto bg-gray-50 rounded-lg p-4 font-mono text-sm space-y-2" id="log-content">
                <div class="log-entry text-gray-700">Application started...</div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // IPC communication with main process
        const { ipcRenderer } = require('electron');

        // Form submission handler
        document.getElementById('api-keys-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const apiKeys = {
                attioToken: document.getElementById('attio-token').value,
                slackBotToken: document.getElementById('slack-bot-token').value,
                slackChannelId: document.getElementById('slack-channel-id').value,
                slackSigningSecret: document.getElementById('slack-signing-secret').value,
                geminiApiKey: document.getElementById('gemini-api-key').value
            };

            try {
                // Send API keys to main process
                const result = await ipcRenderer.invoke('save-api-keys', apiKeys);
                if (result.success) {
                    // Hide setup page and show main interface
                    document.getElementById('setup-page').style.display = 'none';
                    document.getElementById('main-interface').style.display = 'block';

                    // Initialize the main interface
                    log('API keys saved successfully');
                    checkHealth();
                } else {
                    alert('Failed to save API keys: ' + result.message);
                }
            } catch (error) {
                alert('Error saving API keys: ' + error.message);
            }
        });

        // Status update functions
        function updateStatus(elementId, status, text) {
            const indicator = document.querySelector(`#${elementId} .w-3`);
            const textElement = document.getElementById(`${elementId.split('-')[0]}-text`);

            // Only update if elements exist (UI elements may be removed)
            if (indicator && textElement) {
                // Update status indicator color
                indicator.className = 'w-3 h-3 rounded-full mr-2 ' +
                    (status === 'running' ? 'bg-green-500' :
                     status === 'error' ? 'bg-red-500' : 'bg-gray-500');
                textElement.textContent = text;
            }
        }

        function log(message) {
            const logContent = document.getElementById('log-content');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry text-gray-700 text-xs';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Button handlers
        async function startMastra() {
            log('Starting Mastra server...');
            try {
                const result = await ipcRenderer.invoke('start-mastra');
                if (result.success) {
                    log('Mastra server started successfully');
                    checkHealth();
                } else {
                    log('Failed to start Mastra: ' + result.message);
                }
            } catch (error) {
                log('Error starting Mastra: ' + error.message);
            }
        }

        async function stopMastra() {
            log('Stopping Mastra server...');
            try {
                const result = await ipcRenderer.invoke('stop-mastra');
                if (result.success) {
                    log('Mastra server stopped successfully');
                    checkHealth();
                } else {
                    log('Failed to stop Mastra: ' + result.message);
                }
            } catch (error) {
                log('Error stopping Mastra: ' + error.message);
            }
        }


        async function checkHealth() {
            log('Checking server health...');
            try {
                const health = await ipcRenderer.invoke('check-health');

                // Log server status instead of updating UI
                if (health.mastra.status === 'running') {
                    log('✅ Mastra Server is running on port 4111');
                } else {
                    log('❌ Mastra Server is not running');
                }

                log('Health check completed');
            } catch (error) {
                log('Error checking health: ' + error.message);
            }
        }


        // Listen for log messages from main process
        ipcRenderer.on('log-message', (event, message) => {
            log(message);
        });

        // Listen for interface control messages
        ipcRenderer.on('show-main-interface', () => {
            document.getElementById('setup-page').style.display = 'none';
            document.getElementById('main-interface').style.display = 'block';
            log('API keys already configured, showing main interface');
            checkHealth();
        });

        ipcRenderer.on('show-setup-page', () => {
            document.getElementById('setup-page').style.display = 'block';
            document.getElementById('main-interface').style.display = 'none';
            log('No API keys configured, showing setup page');
        });

        // Window control functions
        function minimizeWindow() {
            ipcRenderer.invoke('minimize-window');
        }

        function maximizeWindow() {
            ipcRenderer.invoke('maximize-window');
        }

        function closeWindow() {
            ipcRenderer.invoke('close-window');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            log('VibeB2B interface loaded');

            // Auto-refresh status every 30 seconds (only when main interface is visible)
            setInterval(() => {
                if (document.getElementById('main-interface').style.display !== 'none') {
                    checkHealth();
                }
            }, 30000);
        });

    </script>
</body>
</html>
